!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("core-js/modules/es.array.splice.js"),require("@ecomplus/utils"),require("lodash.merge"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.array.find.js"),require("@ecomplus/client"),require("lodash.clonedeep"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.join.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.array.map.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es.array.splice.js","@ecomplus/utils","lodash.merge","core-js/modules/es.object.keys.js","core-js/modules/es.symbol.js","core-js/modules/es.symbol.description.js","core-js/modules/es.object.to-string.js","core-js/modules/es.symbol.iterator.js","core-js/modules/es.string.iterator.js","core-js/modules/es.array.iterator.js","core-js/modules/web.dom-collections.iterator.js","core-js/modules/es.array.filter.js","core-js/modules/es.array.concat.js","core-js/modules/es.array.slice.js","core-js/modules/es.array.find.js","@ecomplus/client","lodash.clonedeep","core-js/modules/es.string.split.js","core-js/modules/es.regexp.exec.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.array.join.js","core-js/modules/es.array.index-of.js","core-js/modules/es.array.sort.js","core-js/modules/es.array.map.js"],r):"object"==typeof exports?exports.EcomSearch=r(require("core-js/modules/es.array.splice.js"),require("@ecomplus/utils"),require("lodash.merge"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.array.find.js"),require("@ecomplus/client"),require("lodash.clonedeep"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.join.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.array.map.js")):e.EcomSearch=r(e["core-js/modules/es.array.splice.js"],e["@ecomplus/utils"],e["lodash.merge"],e["core-js/modules/es.object.keys.js"],e["core-js/modules/es.symbol.js"],e["core-js/modules/es.symbol.description.js"],e["core-js/modules/es.object.to-string.js"],e["core-js/modules/es.symbol.iterator.js"],e["core-js/modules/es.string.iterator.js"],e["core-js/modules/es.array.iterator.js"],e["core-js/modules/web.dom-collections.iterator.js"],e["core-js/modules/es.array.filter.js"],e["core-js/modules/es.array.concat.js"],e["core-js/modules/es.array.slice.js"],e["core-js/modules/es.array.find.js"],e["@ecomplus/client"],e["lodash.clonedeep"],e["core-js/modules/es.string.split.js"],e["core-js/modules/es.regexp.exec.js"],e["core-js/modules/web.dom-collections.for-each.js"],e["core-js/modules/es.array.join.js"],e["core-js/modules/es.array.index-of.js"],e["core-js/modules/es.array.sort.js"],e["core-js/modules/es.array.map.js"])}(this,(function(e,r,s,t,o,i,n,c,u,a,l,d,f,m,j,p,y,g,b,h,v,q,x,_){return function(e){var r={};function s(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=r,s.d=function(e,r,t){s.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,r){if(1&r&&(e=s(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)s.d(t,o,function(r){return e[r]}.bind(null,o));return t},s.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(r,"a",r),r},s.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},s.p="",s(s.s=24)}([function(r,s){r.exports=e},function(e,s){e.exports=r},function(e,r){e.exports=s},function(e,r){e.exports=t},function(e,r){e.exports=o},function(e,r){e.exports=i},function(e,r){e.exports=n},function(e,r){e.exports=c},function(e,r){e.exports=u},function(e,r){e.exports=a},function(e,r){e.exports=l},function(e,r){e.exports=d},function(e,r){e.exports=f},function(e,r){e.exports=m},function(e,r){e.exports=j},function(e,r){e.exports=p},function(e,r){e.exports=y},function(e,r){e.exports=g},function(e,r){e.exports=b},function(e,r){e.exports=h},function(e,r){e.exports=v},function(e,r){e.exports=q},function(e,r){e.exports=x},function(e,r){e.exports=_},function(e,r,s){"use strict";s.r(r);s(17),s(18),s(4),s(5),s(6),s(7),s(8),s(9),s(10);var t=s(1),o=(s(11),s(19),s(3),s(12),s(20),s(21),s(0),s(13),s(15)),i=function(e,r,s){var t={url:"/items.json",axiosConfig:s};if(!0===r){var i=e.dsl.query;if(t.url+="?q=",i&&i.bool&&Array.isArray(i.bool.filter)){var n="";i.bool.filter.forEach((function(e,r){var s=e.term,t=e.terms;r>0&&(n+=" AND ");var o=s||t;if(o){var i=Object.keys(o)[0],c=o[i];n+="".concat(i,":").concat(Array.isArray(c)?'("'.concat(c.join('" "'),'")'):c)}})),t.url+=encodeURIComponent(n)}["from","size"].forEach((function(r){e.dsl[r]&&(t.url+="&".concat(r,"=").concat(e.dsl[r]))}))}else t.method="post",t.data=e.dsl,r&&!s&&(t.axiosConfig=r);return Object(o.search)(t).then((function(r){var s=r.data;e.result=s;var t=e.dsl,o=e.history,i=e.localStorage,n=e.storageKey;if(s.hits.total&&t&&t.suggest){var c=t.suggest.text;if(c){var u=o.indexOf(c);u>-1&&o.splice(u,1),o.unshift(c),i&&n&&i.setItem(n,o.slice(0,20).join("||"))}}return s}))},n={query:{bool:{filter:[{term:{visible:!0}}]}},sort:[{in_stock:{order:"desc"}},{ad_relevance:{order:"desc"}},"_score"],aggs:{brands:{terms:{field:"brands.name"}},categories:{terms:{field:"categories.name"}},specs:{nested:{path:"specs"},aggs:{grid:{terms:{field:"specs.grid",size:30},aggs:{text:{terms:{field:"specs.text"}}}}}},min_price:{min:{field:"price"}},max_price:{max:{field:"price"}},avg_price:{avg:{field:"price"}}}},c=s(16),u=function(e){return e.dsl=c(n),e.result=void 0,e.setPageSize().setSortOrder()},a=s(2),l=function(e,r){return e.mergeFilter({multi_match:{query:r,fields:["name","keywords"]}},"must"),a(e.dsl,{suggest:{text:r,words:{term:{field:"name"}}}}),e},d=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.dsl.from=e.dsl.size*(r-1),e},f=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;return e.dsl.size=r,e};s(22);var m=function(e,r){var s,t,o,i,c=n.sort.slice();switch(r){case"sales":c.splice(2,0,{sales:{order:"desc"}});break;case"news":c[c.length-1]={_id:{order:"desc"}};break;case"lowest_price":case"highest_price":c.splice(1,0,{price:{order:"lowest_price"===r?"asc":"desc"}});break;case"offers":s=Date.now(),c.splice(1,0,{_script:{type:"number",script:{lang:"painless",source:"doc['price'].value > 0 && doc['base_price'].value > 0 && (doc['price_effective_date.start'].empty || "+"doc['price_effective_date.start'].date.millis <= ".concat(s,"L)")+" && (doc['price_effective_date.end'].empty || "+"doc['price_effective_date.end'].date.millis >= ".concat(s,"L)")+" ? doc['base_price'].value / doc['price'].value : 0"},order:"desc"}});break;case"views":case"":case void 0:case null:c.push({views:{order:"desc"}});break;default:c.splice(1,0,(i={order:"asc"},(o=r)in(t={})?Object.defineProperty(t,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[o]=i,t))}return e.dsl.sort=c,e};s(14);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}var y=function(e,r){var s=e&&e.nested&&e.nested.query;if(s&&s.bool&&Array.isArray(s.bool[r]))return s.bool[r].find((function(e){return e.term}))},g=function(e,r){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"filter",t=Object.keys(r)[0];a(e.dsl,{query:{bool:p({},s,[])}});var o,i=e.dsl.query.bool[s];switch(t){case"terms":case"term":case"multi_match":case"range":if("object"===j(r[t])&&null!==r[t])for(var n=Object.keys(r[t])[0],c=0;c<i.length;c++){var u=i[c][Object.keys(i[c])[0]];if("object"===j(u)&&null!==u&&Object.keys(u)[0]===n)return i[c]=r,e}break;case"nested":if(o=y(r,s))for(var l=Object.keys(o.term)[0],d=o.term[l],f=0;f<i.length;f++){var m=y(i[f],s);if(m&&m.term[l]===d)return i[f]=r,e}}return i.push(r),e},b=function(e,r){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"filter",t=e.dsl.query&&e.dsl.query.bool&&e.dsl.query.bool[s];if(Array.isArray(t))for(var o=0;o<t.length;o++){var i=t[o];if(i.nested&&i.nested.path===r||i[Object.keys(i)[0]][r]){t.splice(o,1);break}}return e},h=function(e,r,s){if(Array.isArray(s))return e.mergeFilter({nested:{path:"specs",query:{bool:{filter:[{term:{"specs.grid":r}},{terms:{"specs.text":s}}]}}}});if(null===s){var t=e.dsl.query&&e.dsl.query.bool&&e.dsl.query.bool.filter;if(Array.isArray(t))for(var o=0;o<t.length;o++)if(t[o]&&t[o].nested){var i=t[o].nested,n=i.path,c=i.query;if("specs"===n&&c&&c.bool){var u=c.bool.filter;if(Array.isArray(u)&&u.find((function(e){var s=e.term;return s&&s["specs.grid"]===r})))return t.splice(o,1),e}}}return e},v=function(e,r,s,t,o){var i=null!==r?"".concat(r,".").concat(s):s;if(Array.isArray(t)){var n,c={terms:{}};return c.terms[i]=t,n=null!==r?"".concat(r,".").concat("_id"===s?"name":"_id"):"_id"===s?"sku":"_id",e.removeFilter(n,o).mergeFilter(c,o)}return null===t?e.removeFilter(i,o):e},q=function(e,r){return v(e,"categories","name",r,"must")},x=function(e,r){return v(e,"categories","_id",r,"must")},_=function(e,r){return v(e,"brands","name",r)},S=function(e,r){return v(e,"brands","_id",r)},k=function(e,r){return v(e,null,"sku",r)},w=function(e,r){return v(e,null,"_id",r)},A=function(e,r,s){var t={};return"number"!=typeof r||isNaN(r)||(t.gte=r),"number"!=typeof s||isNaN(s)||(t.lte=s),e.mergeFilter({range:{price:t}})},O=function(e,r){return r||(r=e.result),Object(t.searchedItems)(r)},P=function(e,r){return r||(r=e.result||{}),r.hits?r.hits.total:void 0},I=function(e,r){return r||(r=e.result||{}),r.suggest&&r.suggest.words||[]},C=function(e,r){var s,t=e.aggregations;return t&&t[r]&&(s=t[r].buckets),Array.isArray(s)&&s||[]},F=function(e,r){return C(r||e.result||{},"brands")},N=function(e,r){return C(r||e.result||{},"categories")},z=function(e,r){r||(r=e.result||{});var s=r.aggregations;return s?{min:s.min_price&&s.min_price.value||0,avg:s.avg_price&&s.avg_price.value||0,max:s.max_price&&s.max_price.value||0}:{min:0,avg:0,max:0}},T=(s(23),function(e,r){if(r||(r=e.result||{}),r.aggregations){var s=r.aggregations.specs;if(s&&s.grid&&Array.isArray(s.grid.buckets))return s.grid.buckets.map((function(e){return{key:e.key,doc_count:e.doc_count,options:e.text&&e.text.buckets||[]}}))}return[]});function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
 * @ecomplus/search-engine
 * (c) E-Com Club <ti@e-com.club>
 * Released under the MIT License.
 */var M="ecomSeachHistory",B="object"===("undefined"==typeof window?"undefined":E(window))&&window.localStorage;r.default=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B,o=this;if(this.storeId=e||t.$ecomConfig.get("store_id"),this.storageKey=r,this.localStorage=s,this.history=[],this.dsl={},this.result=void 0,this.fetch=function(e,r){return i(o,e,r)},this.reset=function(){return u(o)},this.setSearchTerm=function(e){return l(o,e)},this.setPageNumber=function(e){return d(o,e)},this.setPageSize=function(e){return f(o,e)},this.setSortOrder=function(e){return m(o,e)},this.mergeFilter=function(e,r){return g(o,e,r)},this.removeFilter=function(e,r){return b(o,e,r)},this.setSpec=function(e,r){return h(o,e,r)},this.setCategoryNames=function(e){return q(o,e)},this.setCategoryIds=function(e){return x(o,e)},this.setBrandNames=function(e){return _(o,e)},this.setBrandIds=function(e){return S(o,e)},this.setSkus=function(e){return k(o,e)},this.setProductIds=function(e){return w(o,e)},this.setPriceRange=function(e,r){return A(o,e,r)},this.getItems=function(e){return O(o,e)},this.getTotalCount=function(e){return P(o,e)},this.getTermSuggestions=function(e){return I(o,e)},this.getBrands=function(e){return F(o,e)},this.getCategories=function(e){return N(o,e)},this.getPriceRange=function(e){return z(o,e)},this.getSpecs=function(e){return T(o,e)},u(o),s&&r){var n=s.getItem(r);"string"==typeof n&&(o.history=n.split("||"))}}}]).default}));
//# sourceMappingURL=ecom-search.min.js.map